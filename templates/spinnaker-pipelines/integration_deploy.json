{
  "appConfig": {},
  "keepWaitingPipelines": false,
  "lastModifiedBy": "zakcrawford",
  "limitConcurrent": false,
  "parallel": true,
  "parameterConfig": [
    {
      "default": "master",
      "description": "The branch name (with dashes instead of underscores) to deploy",
      "hasOptions": false,
      "name": "Branch"
    },
    {
      "default": "zak",
      "description": "The name of the integration environment (e.g. ckozak05)",
      "hasOptions": false,
      "name": "Stack"
    }
  ],
  "stages": [
    {
      "cloudProvider": "aws",
      "cloudProviderType": "aws",
      "cluster": "baseami-SpinnakerBase-64",
      "credentials": "chartboost-engineering-aws",
      "name": "Find Base AMI",
      "onlyEnabled": false,
      "refId": "2",
      "regions": [
        "us-east-1"
      ],
      "requisiteStageRefIds": [],
      "selectionStrategy": "NEWEST",
      "type": "findImage"
    },
    {
      "amiName": "{{appname}}-${parameters['Branch']}-ubuntu",
      "baseAmi": "${ #stage('Find Base AMI')['context']['amiDetails'][0]['ami']}",
      "baseLabel": "release",
      "baseOs": "ubuntu",
      "cloudProviderType": "aws",
      "comments": "${ #stage('Bake')['context']['extendedAttributes']['deb_files'].split(' ')}",
      "extendedAttributes": {
        "deb_files": "{{appname}}_1.0-${parameters['Branch']}_all.deb"
      },
      "name": "Bake",
      "package": "nfs-common",
      "refId": "3",
      "region": "us-east-1",
      "regions": [
        "us-east-1"
      ],
      "requisiteStageRefIds": [
        "2"
      ],
      "showAdvancedOptions": true,
      "storeType": "ebs",
      "templateFileName": "aws-ebs-dpkg.json",
      "type": "bake",
      "user": "zakcrawford",
      "vmType": "hvm"
    },
    {
      "clusters": [
        {
          "account": "chartboost-engineering-aws",
          "application": "{{appname}}",
          "associatePublicIpAddress": true,
          "availabilityZones": {
            "us-east-1": [
              "us-east-1a",
              "us-east-1d",
              "us-east-1e"
            ]
          },
          "base64UserData": "",
          "capacity": {
            "desired": 1,
            "max": 1,
            "min": 1
          },
          "cloudProvider": "aws",
          "cooldown": 10,
          "ebsOptimized": false,
          "freeFormDetails": "",
          "healthCheckGracePeriod": 600,
          "healthCheckType": "ELB",
          "iamRole": "BaseIAMRole",
          "instanceMonitoring": false,
          "instanceType": "c4.4xlarge",
          "keyPair": "devops-20151021",
          "loadBalancers": [
            "{{appname}}-integration-elb"
          ],
          "maxRemainingAsgs": 2,
          "provider": "aws",
          "scaleDown": true,
          "securityGroups": [
            "sg-2160b946"
          ],
          "stack": "${parameters['Stack']}",
          "strategy": "redblack",
          "subnetType": "internal (dmz)",
          "suspendedProcesses": [],
          "tags": {
            "Environment": "integration",
            "Name": "{{appname}}",
            "Spinnakerized": "yes",
            "Team": "{{teamname}}"
          },
          "targetHealthyDeployPercentage": 100,
          "terminationPolicies": [
            "Default"
          ],
          "useAmiBlockDeviceMappings": false,
          "useSourceCapacity": false,
          "virtualizationType": null
        }
      ],
      "name": "Deploy",
      "refId": "4",
      "requisiteStageRefIds": [
        "3"
      ],
      "type": "deploy"
    },
    {
      "application": "consulserver",
      "failPipeline": true,
      "name": "Deploy Consul",
      "pipeline": "e1b1c969-228d-4039-bab2-5a12fa8ec783",
      "pipelineParameters": {
        "stackname": "${parameters['Stack']}"
      },
      "refId": "5",
      "requisiteStageRefIds": [],
      "type": "pipeline"
    }
  ],
  "triggers": [],
  "updateTs": "1490048502000"
}

